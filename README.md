# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

### 1. BaseComponent\<T>
Находится в основе всех визуальных представлений, включает в себя базовые операции работы с компонентом.
Класс является дженериком и принимает тип данных <T> для последующего приема данных этого типа при отрисовке.

Аргументы конструктора:
* container - элемент разметки компонента
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии

Методы:
* render - отрисовывает содержимое компонента копируя значения полей аргумента в текущий экземпляр, тем самым вызывает сеттеры,
которые реализуют процесс заполнения данными элементов компонента

Поля:
* container - элемент разметки компонента

### 2. Api
Основной класс взаимодействия с внешними системами хранения и обработки данных, включает базовый интерфейс 
обращения по протоколу HTTP.

Аргументы конструктора:
* baseUrl - базовая адресная строка (URL) внешней системы
* options - опции отправляемые при каждом запросе

Методы:
* get<T> - получает данные методом GET и преобразовывать в тип T
* post<T> - отправляет данные одним из методов: POST, PUT, DELETE и преобразовывать полученный результат в тип T

### 3. EventEmitter
Реализует паттерн "Наблюдатель" для подписки и уведомления о событии, реализует интерфейс IEvents.
Позволяет использовать централизованное хранилище обработчиков событий, своевременно и гибко управлять 
отвязкой обработчиков, а так же избежать связности между компонентами путем передачи управления брокеру.

Методы:
* on - подписка на событие
* off - отписка от события
* emit - уведомление о наступлении события
* trigger - сделать коллбек триггер, генерирующий событие при вызове
* onAll - подписка на все события
* offAll - сбросить все обработчики событий

## Компоненты коммуникации

### 1. ShopApi
Является наследником класса **Api**, отвечает за взаимодействие с внешним сервисом интернет-магазина

Конструктор родителя по умолчанию.

Методы:
* addOrder - добавить заказ
* getAllProducts - получить информацию обо всех продуктах в магазине
* getProductById - получить информацию о конкретном продукте по уникальному идентификатору

## Компоненты модели данных

### 1. Storage
Хранилище данных о продуктах загруженных с сервера, находящихся товарах в корзине, заполненных контактных данных, адресе и способе оплаты.
При изменении списка продуктов или изменении состояния корзины инициирует события в брокер

Аргументы конструктора:
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии

Методы:
* getProductById - получить продукт по уникальному идентификатору
* clearBasket - очистить корзину
* clearOrder - очистить информацию об адресе и способе оплаты
* clearContacts - очистить информацию о контактах клиента
* addProductToBasket - добавить товар в корзину
* removeProductFromBasket - удалить товар из корзины
* isInBasket - проверить, есть ли товар в корзине
* getProductsInBasket - получает список продуктов, находящихся в корзине
* getCurrentOrder - получить текущий заказ из данных корзины, адресе, способе оплаты и информации о контактах 


Поля:
* basket - информация о данных в корзине
* products - все загруженные продукты
* order - информация об адресе и способе оплаты
* contacts - информация о контактах пользователя: телефон и email

## Компоненты представления

### 1. Modal
Компонент модального окна состоящий из кнопки и внутреннего контейнера.

Наследуется от класса BaseComponent. 

Реализует отключение всплытия для внутреннего контейнера, операции открытия и закрытия с уведомлением в брокер событий.

Конструктор родителя без дополнительных аргументов.

Методы:
* close - закрывает модальное окно
* open - открывает модальное окно

Поля:
* closeButtonElement - элемент разметки кнопки закрытия модального окна
* innerContentElement - элемент разметки внутреннего контейнера


### 2. Card
Универсальный компонент карточки товара.

Наследуется от класса BaseComponent. 

Реализует отображение карточки товара во всех ее представлениях: в списке на странице, в модальном окне и в корзине.

Конструктор принимает следующие аргументы:
* template - экземпляр типа HTMLTemplateElement, который является шаблоном элемента в разметке
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии
* action? - экземпляр типа ICardAction содержащий обработчик события нажатия мышью на кнопку (или контейнер в случае списка)

Поля:
* id - уникальный идентификатор продукта
* categoryElement - элемент разметки категории продукта
* titleElement - элемент разметки наименования продукта
* imageElement - элемент разметки фотографии продукта
* priceElement - элемент разметки цены на продукт
* descriptionElement - элемент разметки с детальным описанием о продукте
* buttonElement - элемент кнопки добавления и удаления товара из корзины
* itemIndexElement - элемент разметки порядкового номера (для корзины)

### 3. Basket
Визуальное представление корзины в модальном окне.

Наследуется от класса BaseComponent.

Позволяет просмотреть список добавленных товаров, удалить или перейти к оформлению.

Конструктор принимает следующие аргументы:
* template - экземпляр типа HTMLTemplateElement, который является шаблоном элемента в разметке
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии

Поля:
* basketCardListElement - элемент разметки контейнера с карточками
* submitButton - кнопка оформления 
* priceElement - общая цена

Методы:
* setPrice - устанавливает значение общей суммы товаров в корзине
* render (переопределен) - принимает массив элементов разметки (карточек продуктов) и помещает во внутренний контейнер

### 4. Order
Визуальное представление модального окна оформления заказа с выбором типа оплаты и указанием адреса.

Наследуется от класса BaseComponent.

Конструктор родителя без дополнительных аргументов.

Методы:
* updateOrderButtonState - обновить состояние кнопки исходя из заполненных данных

Поля:
* address - адрес
* payment - тип оплаты
* cardButtonElement - элемент разметки кнопки выбора оплаты картой
* cashButtonElement - элемент разметки кнопки выбора оплаты наличными
* addressElement - элемент разметки поля ввода адреса
* orderButtonElement - элемент разметки кнопки перехода на страницу заполнения контактных данных

### 5. Contacts
Визуальное представление модального окна оформления заказа с заполнением контактных данных телефона и почты

Наследуется от класса BaseComponent.

Конструктор родителя без дополнительных аргументов.

Методы:
* updateSubmitButtonState - обновить состояние кнопки исходя из заполненных данных

Поля:
* email - почтовый адрес
* phone - номер телефона
* emailElement - элемент разметки почтового адреса
* phoneElement - элемент разметки номера телефона
* submitButtonElement - элемент разметки кнопки оформления заказа


### 6. Success
Визуальное отображение модального окна с успешным оформлением заказа.

Наследуется от класса BaseComponent.

Конструктор принимает следующие аргументы:
* template - экземпляр типа HTMLTemplateElement, который является шаблоном элемента в разметке
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии

Поля:
* total - сумма заказа
* titleElement - заголовок "Заказ оформлен"
* descriptionElement - информация о списании средств
* buttonElement - кнопка возврата к списку товаров (за новыми покупками)

### 7. Page
Класс представляет основную страницы приложения.

Позволяет управлять отдельными элементами на странице: фиксация для модального окна, изменение значения количества товаров 
в корзине на иконке, инициирует события в брокер при нажатии на кнопку корзины, а так же содержит контейнер для карточек и позволяет
помещать элементы карточек в этот контейнер

Конструктор принимает следующие аргументы:
* rootElement - корневой элемент страницы в разметке
* events - экземпляр реализующий паттерн "Наблюдатель" для подписки и уведомления о событии

Поля:
* productCards - контейнер карточек продуктов, сеттер позволяет помещать массив элементов в контейнер
* basketCounter - элемент разметки с количеством товаров в корзине
* pageWrapper - элемент внешней обертки страницы для блокировки и разблокировки при открытии модального окна
* basketButton - элемент кнопки корзины

Методы:
* lock - заблокировать прокрутку страницы
* unlock - разблокировать прокрутку страницы

## События Event Emitter

* modal:close - закрытие модального окна
* modal:open - открытие модального окна
* products:changed - изменен список продуктов в хранилище
* preview:selected - выбрана карточка в списке для предварительно просмотра с возможностью добавления в корзину
* preview:submit - добавление и удаление продукта в корзину из модального окна предварительного просмотра
* basket:changed - изменение содержимого корзины
* basket:open - открытие корзины
* basket:remove - удаление товара из корзины
* basket:submit - переход к оформлению товаров в корзине
* order:submit - успешное заполнение системы оплаты, адреса и переход к следующему этапу оформления заказа
* contacts:submit - успешно заполнение контактных данных и переход к следующему этапу оформления заказа
* success:submit - возврат к списку продуктов после успешного оформления заказа














